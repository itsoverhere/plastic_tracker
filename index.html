<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>


	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

	<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-auth-compat.js"></script>
	<script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

	<script src="https://www.gstatic.com/firebasejs/ui/6.0.0/firebase-ui-auth.js"></script>
	<link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.0.0/firebase-ui-auth.css" />

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

	<link rel="stylesheet" href="css/style.css" />
	<script src="js/index.var.js"></script>


	<style>
		div.details {
			display: none;
		}

	</style>

</head>

<body>

	<!--	<div id="firebaseui-auth-container" class="focused"></div>-->
	<div class="container-fluid m-0 p-0 g-2 overflow-hidden">

		<div class="authentication row justify-content-center">
			<div class="col col-md-3 col-xs-1">
			</div>
			<div class="col col-md-6 col-xs-10">
				<div class="title row">
					#ecosquadgoals
				</div>

				<div class="p-2 row">
					<div class="label col-4">
						Email
					</div>
					<div class="col-8">
						<input type="email" class="form-control" />
					</div>
				</div>

				<div class="p-2 row">
					<div class="label col-4">
						Password
					</div>
					<div class="col-8">
						<input type="password" class="form-control" />
					</div>
				</div>

				<div class="row gy-2">
					<div>
						<button class="col btn btn-primary p-2" type="button" id="sign_up">
							Sign up
						</button>
					</div>
					<div>
						<button class="col btn btn-primary p-2" type="button" id="sign_in">
							Sign in
						</button>
					</div>
				</div>

				<div class="row">
					Or, sign in using Google
				</div>

			</div>

			<div class="col col-md-3 col-xs-1">
			</div>

		</div>

		<div class="details row justify-content-center">
			<div class="col col-md-3 col-xs-1">
			</div>
			<div class="col col-md-6 col-xs-10">
				<div class="title row">
					Please complete your registration
				</div>

				<div class="p-2 row">
					<div class="label col-4">
						Participant ID
					</div>
					<input type="text" class="col-8 form-control" />
				</div>

				<div class="p-2 row">
					<div class="label col-4">
						Affiliation
					</div>
					<input type="text" class="col-8 form-control" />
				</div>

				<div class="p-4 row">
					<button class="col">
						Submit
					</button>
				</div>

				<div class="col col-md-3 col-xs-1">
				</div>

			</div>

			<div class="col col-md-3 col-xs-1">
			</div>
		</div>


		<div class="modal fade" id="spinner_modal" tabindex="-1" aria-labelledby="riversnap_modal_label" aria-hidden="true" data-backdrop="static" data-keyboard="false">
			<div class="modal-dialog modal-dialog-centered spinner_modal">
				<img src="assets/spinner.gif">
			</div>
		</div>
	</div>
	<!--
<div class="authentication container focused">
	<form id="authentication_form">
		<span class="title">#ecosquadgoals</span>
		<span class="label">Email</span>
		<input type="email" id="email">
		<span class="label">Password</span>
		<input type="password" id="password">
		<div class="button_container">

			<div class="button" id="signup">Sign up</div>
			<div class="button" id="signin">Sign in</div>
		</div>
	</form>
	<span id="google_sso">Or, sign in using Google</span>
</div>

<div class="details container">
	<form id="details_form">
		<span class="title">Please complete your registration</span>
		<span class="label">Affiliation</span>
		<input type="text" id="affiliation">
		<span class="label">Participant ID</span>
		<input type="text" id="pid">
		<div class="button" id="complete">Complete</div>
	</form>
</div>
-->

	<script>
		/*
																																																																									let app, auth
																																																																									let currentUser = {}
																																																																									let notifier = new AWN()

																																																																									window.addEventListener('load', function() {
																																																																										initApp()
																																																																									});

																																																																									initApp = function() {
																																																																										showSpinner()
																																																																										Promise.resolve()
																																																																											.then(setupFirebase)
																																																																											.then(() => {
																																																																												firebase.auth().onAuthStateChanged(function(user) {
																																																																													if (user) {
																																																																														hasCompleteDetails(user.uid).then(() => {
																																																																															window.location.href = "bootstrap.html"
																																																																														}, () => {
																																																																															currentUser["email"] = user.email
																																																																															currentUser["uuid"] = user.uid
																																																																															toggleDetailsForm(true)
																																																																															hideSpinner()
																																																																														})
																																																																													}
																																																																												}, function(error) {
																																																																													notifier.alert(error.message)
																																																																												});
																																																																												hideSpinner()
																																																																											})
																																																																									};

																																																																									function setupFirebase() {
																																																																										return new Promise((resolve) => {
																																																																											const firebaseConfig = {
																																																																												apiKey: "AIzaSyBx-vcALRbrfXRGpyMwZHGgTH_0mgQI_xk",
																																																																												authDomain: "plastic-tracker-2cbb7.firebaseapp.com",
																																																																												projectId: "plastic-tracker-2cbb7",
																																																																												storageBucket: "plastic-tracker-2cbb7.appspot.com",
																																																																												appId: "1:645843325306:web:5f4b90dc9388fe16f4c6c3",
																																																																												measurementId: "G-2FF14XFMB6"
																																																																											};
																																																																											app = firebase.initializeApp(firebaseConfig);

																																																																											resolve()
																																																																										})
																																																																									}

																																																																									function toggleDetailsForm(show) {
																																																																										if (show) {
																																																																											$("div.container.authentication").removeClass("focused")
																																																																											$("div.container.details").addClass("focused")
																																																																										} else {
																																																																											$("div.container.authentication").addClass("focused")
																																																																											$("div.container.details").removeClass("focused")
																																																																										}
																																																																									}

																																																																									function hasCompleteDetails(id) {
																																																																										return new Promise((resolve, reject) => {
																																																																											firebase.firestore()
																																																																												.collection("users")
																																																																												.doc(id)
																																																																												.get()
																																																																												.then((doc) => {
																																																																													if (doc.data() && doc.data().affiliation && doc.data().pid) {
																																																																														resolve()
																																																																													} else {
																																																																														reject()
																																																																													}
																																																																												}).catch((error) => {
																																																																													notifier.alert(error.message)
																																																																													reject()
																																																																												})
																																																																										})
																																																																									}

																																																																									function signUpViaGoogle() {
																																																																										showSpinner()
																																																																										var provider = new firebase.auth.GoogleAuthProvider();
																																																																										firebase.auth()
																																																																											.signInWithPopup(provider)
																																																																											.then((result) => {
																																																																												var user = result.user;
																																																																												if (user) {
																																																																													hasCompleteDetails(user.uid).then(() => {
																																																																														window.location.href = "bootstrap.html"
																																																																													}, () => {
																																																																														currentUser["email"] = user.email
																																																																														currentUser["uuid"] = user.uid
																																																																														toggleDetailsForm(true)
																																																																														hideSpinner()
																																																																													})
																																																																												}
																																																																											}).catch((error) => {
																																																																												console.log("Google sign up error: " + errorMessage)
																																																																												notifier.alert("Something went wrong, please try again.")
																																																																											});
																																																																									}

																																																																									function showSpinner() {
																																																																										$("div.spinner_container").addClass("focused")
																																																																										$("div.spinner_container img").addClass("focused")
																																																																									}

																																																																									function hideSpinner() {
																																																																										$("div.spinner_container").removeClass("focused")
																																																																										$("div.spinner_container img").removeClass("focused")
																																																																									}
																																																																							*/

	</script>

	<script>
		/*
																																																																									$(document).ready(function() {

																																																																										$("#google_sso").click(() => {
																																																																											signUpViaGoogle()
																																																																										})

																																																																										$("div.button#signin").click(() => {
																																																																											showSpinner()
																																																																											let email = $("input#email").val()
																																																																											let password = $("input#password").val()
																																																																											firebase.auth()
																																																																												.signInWithEmailAndPassword(email, password)
																																																																												.then((user) => {
																																																																													hasCompleteDetails(user.uid).then(() => {
																																																																														window.location.href = "bootstrap.html"
																																																																													}, () => {
																																																																														currentUser["email"] = user.email
																																																																														currentUser["uuid"] = user.uid
																																																																														toggleDetailsForm(true)
																																																																														hideSpinner()
																																																																													})
																																																																												})
																																																																												.catch((error) => {
																																																																													notifier.alert(error.message)
																																																																													hideSpinner()
																																																																												})
																																																																										})


																																																																										$("div.button#signup").click(() => {
																																																																											showSpinner()
																																																																											let email = $("input#email").val()
																																																																											let password = $("input#password").val()
																																																																											firebase.auth()
																																																																												.createUserWithEmailAndPassword(email, password)
																																																																												.then((user) => {
																																																																													currentUser["email"] = user.email
																																																																													currentUser["uuid"] = user.uid
																																																																													toggleDetailsForm(true)
																																																																													hideSpinner()
																																																																												})
																																																																												.catch((error) => {
																																																																													notifier.alert(error.message)
																																																																													hideSpinner()
																																																																												})
																																																																										})

																																																																										$("div.button#complete").click(() => {
																																																																											hideSpinner()

																																																																											let affiliation = $("input#affiliation").val()
																																																																											let pid = $("input#pid").val()
																																																																											let email = currentUser["email"]

																																																																											firebase.firestore().collection("users")
																																																																												.doc(currentUser["uuid"])
																																																																												.set({
																																																																													email, affiliation, pid,
																																																																												}, {
																																																																													merge: true
																																																																												}).then(() => {
																																																																													window.location.href = "bootstrap.html"
																																																																													hideSpinner()
																																																																												}).catch((error) => {
																																																																													notifier.alert(error.message)
																																																																													hideSpinner()
																																																																												})
																																																																										})

																																																																										$("form").submit((e) => {
																																																																											e.preventDefault()
																																																																										})
																																																																									})
																																																																							*/

	</script>


	<!-- Option 1: Bootstrap Bundle with Popper -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

</body>

</html>
